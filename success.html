<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>验证通过</title>
  <link rel="icon" href="./assets/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="bg"></div>
  <main class="wrap">
    <section class="card" role="region" aria-label="验证通过">
      <header class="header">
        <div class="brand">
          <div class="lock" aria-hidden="true" style="color:var(--green);">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
              <path d="M9 12l2 2 4-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M20 12c0 4.418-3.582 8-8 8s-8-3.582-8-8 3.582-8 8-8 8 3.582 8 8Z" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <h1>验证通过</h1>
        </div>
      </header>

      <section class="panel">
        <div class="tip-text" style="font-size:16px;">
          你已通过验证。若未能自动跳转，请从下方入口列表进入官网：
        </div>

        <section class="result" style="margin-top:14px;">
          <div class="result-title">官网入口列表</div>
          <div id="list" class="result-list"></div>
          <div class="result-foot">
            为安全起见，页面仅展示经过脱敏处理的域名，点击“进入”将在新窗口打开真实官网地址。
          </div>
        </section>

        <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
          <a class="btn-ghost" style="text-decoration:none; display:inline-flex; align-items:center;"
             href="./index.html">返回验证页</a>
        </div>
      </section>

      <footer class="foot">
        <span>提示：此页面为纯前端静态项目，无需后端。</span>
      </footer>
    </section>
  </main>

  <script src="./config.js"></script>
  <script>
    (function(){
      function maskHost(host){
        if (!host) return host;
        if (/^\d{1,3}(?:\.\d{1,3}){3}$/.test(host)){
          const p = host.split(".");
          const a2 = p[0].length >= 2 ? p[0].slice(0,2) : p[0];
          return a2 + "******" + p[2] + "." + p[3];
        }
        const keepHead = 2, keepTail = 5;
        if (host.length <= keepHead + keepTail) return host;
        return host.slice(0,keepHead) + "****" + host.slice(-keepTail);
      }
      function maskUrl(url){
        try{
          const u = new URL(url);
          const maskedHost = maskHost(u.host);
          return u.protocol + "//" + maskedHost + ((u.pathname && u.pathname !== "/") ? u.pathname : "");
        }catch{ return url; }
      }
      function esc(s){
        return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;");
      }

      const cfg = window.VERIFY_CONFIG || {};
      const entries = Array.isArray(cfg.entries) ? cfg.entries.filter(e => e && e.url) : [];
      const listEl = document.getElementById("list");

      if (!entries.length){
        listEl.innerHTML = '<div class="entry"><div class="entry-left"><div class="badge">!</div><div class="entry-main"><div class="entry-name">未配置入口</div><div class="entry-note">请在 config.js 的 entries 中填写官网地址列表。</div></div></div></div>';
        return;
      }
      const mask = cfg.maskDisplay !== false;

      entries.forEach((e, idx) => {
        const name = e.name || ("官网入口 " + (idx+1));
        const url = e.url;
        const note = e.note || "大陆推荐使用，海外网站会提示不安全，无视即可。";
        const shown = mask ? maskUrl(url) : url;

        const div = document.createElement("div");
        div.className = "entry";
        div.innerHTML = `
          <div class="entry-left">
            <div class="badge">${idx+1}</div>
            <div class="entry-main">
              <div class="entry-name">${esc(name)}</div>
              <div class="entry-url">${esc(shown)}</div>
              <div class="entry-note">${esc(note)}</div>
            </div>
          </div>
          <button class="entry-btn" type="button">点击进入</button>
        `;
        div.querySelector(".entry-btn").addEventListener("click", () => window.open(url, "_blank", "noopener"));
        listEl.appendChild(div);
      });
    })();
  </script>
</body>
</html>
